
Studies of galaxy evolution, galaxy clusters, large-scale structure, weak lensing, etc all rely on the determination of galaxy redshift.
Spectroscopic surveys of galaxies can provide very accurate redshifts by measuring the shifted wavelengths of sharp spectral features such as emission and absorption lines.
Despite advancements in multi-object spectrographs, spectroscopic measurements are expensive and time-consuming and we can only collect spectra for a small fraction of the galaxies that can be imaged by  modern surveys, such as the Dark Energy Survey (DES; \citealt{TheDarkEnergySurveyCollaboration2005}) and the Kilo-Degree Survey (KiDS; \citealt{DeJong2013a}).
This problem will only increase in magnitude as the next generation of surveys, such as the Vera Rubin Observatory Legacy Survey of Space and Time (LSST; \citealt{LSSTScienceCollaboration2009}) and the Wide-Field Infrared Survey Telescope (WFIRST; \citealt{Green2012}), image orders of magnitude more galaxies at fainter magnitudes than are present in current data sets.
As a result, rather than rely on spectroscopic redshifts (spec-z's), modern surveys increasingly rely on photometric redshifts (photo-z's; see \citealt{Salvato2019} for a review).

Photo-z's are estimates of galaxy redshifts derived from changes in the colors of galaxies as their spectral energy distributions (SED's) redshift through a series of broadband filters.
This estimation is typically done using one of two approaches: machine learning (ML) or template fitting (see e.g. \citealt{Schmidt2020} for an evaluation of many examples of the two).

Machine learning approaches train on a data set of photometry with spec-z's and attempt to directly learn an empirical relationship between galaxy colors and redshift (e.g. \citealt{Connolly95}, \texttt{TPZ} \citealt{Kind2013}, \texttt{FlexZBoost} \citealt{Izbicki2017}, \texttt{CMNN} \citealt{Graham2018a}).
Once trained, they can predict galaxy redshifts given photometry alone.
The advantage of ML methods is that the effects of dust, galaxy evolution, and other relevant variables are encoded in the training set and thus accounted for in the derived mapping from colors to redshift.
The downside of ML methods is that their success relies on how representative and well-controlled the training set is, and that they are unable to extrapolate beyond that set.

Template fitting photo-z estimators (e.g. \texttt{LePhare} \citealt{Arnouts1999}, \bpz\ \citealt{Benitez2000a}, \texttt{EAZY} \citealt{Brammer2008}) work on the assumption that galaxy photometry are sampled from a relatively small set of underlying spectral types, characterized by the eponymous SED templates. 
These estimators calculate photo-z's by selecting the template and redshift with simulated fluxes most similar to the observed fluxes. 
In order for this method to work, the underlying SED templates from which the galaxies are sampled must be known. 
Common methods for generating these templates include simulating galaxy SED's from spectral synthesis models, e.g. \citet{BruzualA.1993a}, and deriving templates from the observed spectra of local galaxies, e.g. \citet{Benitez2004a}. 

The primary advantage of template fitting methods is that it is not limited to the bounds of a training set. 
A key limitation is that they do not guarantee that the SED templates will span the full distribution of galaxy spectra in a given data set, nor that they will properly account for the effects of dust, or spectral evolution.
In addition, spectral synthesis models are only able to generate spectra with a discrete set of physical parameters (e.g. temperature, age, metallicity), and obtaining real galaxy spectra is expensive, especially at the redshifts and magnitudes that will be observed by LSST.

Several previous works have attempted to combine the advantages of these two approaches by deriving SED templates from a photometric training set, and then using the derived templates for photo-z estimation (\citealt{Budavari2000b,Csabai2000}). These approaches
leverage a large set of galaxy photometry, which amount to low resolution spectra, to sample a smaller set of SED templates across a broad range of rest wavelengths.
This effectively over-samples the template SED's, allowing us to reconstruct spectral features at a resolution much higher than that of the broadband filters used to measure the photometry.
This  is analogous to the Drizzle technique used to reconstruct higher resolution images for the Hubble Space Telescope (HST; \citealt{Fruchter2002}) and the reconstruction of SED's using differential chromatic refraction (DCR; \citealt{Lee2019}).


This template learning approach retains the physical motivation and extensibility of the template fitting method, while taking advantage of learning the systematics and confounding variables implicit in the training set.
In addition, it opens the possibility of learning a smooth continuum of galaxy spectra, in contrast to the discrete set offered by the limited galaxy observations and galaxy modeling codes. 

While previous works attempt to learn galaxy templates from data using a set of eigenspectra, we adapt the algorithm of \citet{Budavari2000b} to directly learn a set of templates from the data.%, using a large set of top hat bins as our parameters.
We extend these earlier works by applying our methods to a large data set of 102,476 galaxies with spec-z's and photometry in 19 bands.
In this manner we are able to learn a variable number of SED templates with clear spectral features, and with simple postprocessing, we are able to further reconstruct emission lines in the bluest templates.

We show that templates can be learned from scratch or as perturbations of pre-existing templates.
We use these learned templates to estimate photo-z's with \bpz\ and find that the training reduces the bias and scatter of the redshift estimates, with little impact on the fraction of catastrophic outliers.
In addition, we find that both bias and scatter decrease with the number of SED templates used in the photo-z estimation.

The outline of the paper is as follows:
in Section \ref{sect:template_training} we describe the template training algorithm, including how to match photometry to templates, how to perturb templates to better match the photometry, and how to select the hyperparameters for training.
In Section \ref{sect:data}, we describe the spec-z and photometric data sets used in the template training and redshift estimation.
In Section \ref{sect:application}, we apply the template training algorithm to sets of naive templates and to a pre-existing set of templates derived from galaxy observations and spectral synthesis models.
We discuss the performance of the algorithm including its convergence, and the accuracy of the reconstructions.
In Section \ref{sect:photoz}, we use our templates to estimate photo-z's for a training set of galaxies and analyze the results.
We discuss our results and future goals in Section \ref{sect:discussion} and conclude in Section \ref{sect:conclusion}.